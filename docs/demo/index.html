<!DOCTYPE html>
<html>
  <head>
    <title>API Demo - Citation.js</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/png" href="../favicon.png"/>
    <link rel="icon" type="image/png" href="../favicon.png"/>
    <link rel="stylesheet" type="text/css" href="../static/css/highlight.css" />
    <link rel="stylesheet" type="text/css" href="../static/css/demo.css" />
  </head>
  <body>
    <h1>Citation.js - demo</h1>
    <h2>Input:</h2>
    <p><b style="font-size:12px;">Note that the inputs are interchangable. You could, for example, paste a URL in the JSON box. The syntax won't be coloured, but the output will be correct.</b></p>
    <h4>JSON:</h4>
    <div id="json-in" data-type="json" class="in javascript" contenteditable="true" spellcheck="false"><!--
-->[
  {
    id: "Q23571040",
    type: "article-journal",
    title: "Correlation of the Base Strengths of Amines 1",
    DOI: "10.1021/ja01577a030",
    author: [
      {
	given: "H. K.",
	family: "Hall"
      }
    ],
    issued: [
      {
	date-parts: [ "1957", "1", "1" ]
      }
    ],
    container-title: "Journal of the American Chemical Society",
    volume: "79",
    issue: "20",
    page: "5441-5444"
  }
]<!--
      --></div>
    <h4>BibTeX:</h4>
    <div id="bibx-in" data-type="bib" class="in bibtex" contenteditable="true" spellcheck="false"><!--
-->@article{Steinbeck2003,
  author = {Steinbeck, Christoph and Han, Yongquan and Kuhn, Stefan and Horlacher, Oliver and Luttmann, Edgar and Willighagen, Egon},
  year = {2003},
  title = {{The Chemistry Development Kit (CDK): an open-source Java library for Chemo- and Bioinformatics.}},
  journal = {Journal of chemical information and computer sciences},
  volume = {43},
  number = {2},
  pages = {493--500},
  doi = {10.1021/ci025584y},
  isbn = {2214707786},
  issn = {0095-2338},
  pmid = {12653513},
  url = {http://www.ncbi.nlm.nih.gov/pubmed/12653513}
}<!--
      --></div>
    </div>
    <h4>Wikidata/URL:</h4>
    <p><b style="font-size:12px;">Note that Citation.js parses input via chaining. The data the URL points at is captured an re-parsed, so if the URL points to a text file containing an URL pointing to the first URL, you get an infinite loop. However, URL's pointing to itself are accounted for.</b></p>
    <div id="wiki-in" data-type="url" class="in url" contenteditable="true" spellcheck="false"><!--
      -->https://www.wikidata.org/wiki/Q21972834<!--
    --></div>
    <h4>BibJSON:</h4>
    <p><b style="font-size:12px;">More coming soon.</b></p>
    <div id="bibj-in" data-type="json" class="in javascript" contenteditable="true" spellcheck="false"><!--
-->{
  "publisher": {
    "value": [
      "BioMed Central"
    ]
  },
  "journal": {
    "value": [
      "Journal of Ethnobiology and Ethnomedicine"
    ]
  },
  "title": {
    "value": [
      "Gitksan medicinal plants-cultural choice and efficacy"
    ]
  },
  "authors": {
    "value": [
      "Leslie Main Johnson"
    ]
  },
  "date": {
    "value": [
      "2006-06-21"
    ]
  },
  "doi": {
    "value": [
      "10.1186/1746-4269-2-29"
    ]
  },
  "volume": {
    "value": [
      "2"
    ]
  },
  "issue": {
    "value": [
      "1"
    ]
  },
  "firstpage": {
    "value": [
      "1"
    ]
  },
  "fulltext_html": {
    "value": [
      "http://ethnobiomed.biomedcentral.com/articles/10.1186/1746-4269-2-29"
    ]
  },
  "fulltext_pdf": {
    "value": [
      "http://ethnobiomed.biomedcentral.com/track/pdf/10.1186/1746-4269-2-29?site=http://ethnobiomed.biomedcentral.com"
    ]
  },
  "license": {
    "value": [
      "This article is published under license to BioMed Central Ltd. This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/2.0), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited."
    ]
  },
  "copyright": {
    "value": [
      "2006 Johnson; licensee BioMed Central Ltd."
    ]
  }
}<!--
     --></div>
    <h2>Output:</h2>
    <fieldset>
      <legend>HTML or plain text:</legend>
      <select class="type">
	<option value="html">HTML</option>
        <option value="json">JSON</option>
	<option value="string">Plain text</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Style:</legend>
      <select class="style">
	<option value="citation-apa">APA</option>
	<option value="citation-vancouver">Vancouver</option>
	<option value="citation-harvard1">Harvard</option>
	<option value="csl">CSL-JSON</option>
	<option value="bibtex">BibTeX</option>
        <option value="bibtxt">Bib.TXT</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Language:</legend>
      <select class="lang">
	<option value="en-US">English</option>
	<option value="fr-FR">French</option>
	<option value="es-ES">Spanish</option>
	<option value="de-DE">German</option>
	<option value="nl-NL">Dutch</option>
      </select>
    </fieldset>
    <h4>From JSON input:</h4>
    <div id="json-out" data-type="json" class="out"></div>
    <h4>From BibTeX input:</h4>
    <div id="bibx-out" data-type="bib" class="out"></div>
    <h4>From Wikidata/URL input:</h4>
    <!--p><b style="font-size:12px;">Note that Citation.js can't parse every Wikidata property. This would require many calls to the database, since properties often have numeric-id's instead of values.</b></p-->
    <div id="wiki-out" data-type="url" class="out"></div>
    <h4>From ContentMine input:</h4>
    <div id="bibj-out" data-type="cm" class="out"></div>
    <h2>Live code:</h2>
    <pre><code data-type="js" class="javascript"></code></pre>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../src/citation.min.js"></script>
    <script type="text/javascript" src="../static/js/highlight.js"></script>
    <script class="code" type="text/javascript">
var Cite = require('citation-js')

// Set variables
var cite = new Cite()
var opt = {
  format: 'string'
}

// Make shorter ref to function
var parseAsync = Cite.parse.input.async.chain

// Make a factory for callback
var callbackFactory = function (out) {
  return function (data) {
    out.html(cite.set(data).get(opt))
  }
}

$(function(){
  // jQuery elements
  var $json_in = $('#json-in'),
      $bibx_in = $('#bibx-in'),
      $wiki_in = $('#wiki-in'),
      $bibj_in = $('#bibj-in'),
      $type = $('select.type'),
      $styl = $('select.style'),
      $lang = $('select.lang')
  
  // Callbacks
  var jsonCb = callbackFactory($('#json-out')),
      bibxCb = callbackFactory($('#bibx-out')),
      wikiCb = callbackFactory($('#wiki-out')),
      bibjCb = callbackFactory($('#bibj-out'))
  
  // Declare function to update the output
  function update() {
    // Get user options
    opt.type = $type.val()
    opt.style = $styl.val()
    opt.lang = $lang.val()
    
    // Set data (explicit parsing only recommended for async) and set html element to get output
    parseAsync($json_in).then(jsonCb)
    parseAsync($bibx_in).then(bibxCb)
    parseAsync($wiki_in).then(wikiCb)
    parseAsync($bibj_in).then(bibjCb)
  }
  
  // Make output update when input is defocussed...
  $('.in').on('blur', update)
  // ... or a select tag has changed
  $('select').on('change', update)
  
  // Trigger update
  update()
})
    </script>
    <script type="text/javascript">
      $(window).on('load',function(){
	// Insert live code, directly from the script element (!)
	$('pre code.javascript').html($('.code').html());	
	
	// Highlight all code
	$('.javascript,.in').highlight();
	
	// Remove and re-add highlighting on focus and blur
	$('.in').focus(function(){$(this).find('span').each(function(){$(this).after(this.textContent);$(this).remove();});});
	$('.in').blur(function(){$(this).highlight()});
      });
    </script>
  </body>
</html>